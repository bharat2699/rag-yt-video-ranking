# YouTube Video Ranking System

This project implements a microservice for ranking YouTube videos based on semantic relevance to a user query. It uses the YouTube Data API to fetch video details, transcripts, and statistics, and ranks videos using embeddings generated by Sentence Transformers. The application is containerized using Docker and exposes a Flask-based REST API for interaction.

## Key Features

- **YouTube Video Search**: Fetches video metadata, transcripts, and statistics (views, likes, comments).
- **Semantic Ranking**: Uses Sentence Transformers to compute embeddings and ranks videos based on similarity to the query.
- **Score Enhancement**: Adjusts ranking scores based on video views and duration.
- **Filtering**: Excludes videos with fewer than 10 views or durations shorter than 2 minutes.
- **CSV Export**: Saves ranked results to a CSV file with human-readable durations.
- **REST API**: Provides an endpoint for querying and retrieving ranked video links.
- **Dockerized Deployment**: Runs as a containerized microservice for easy deployment.

## Features

- YouTube video search using YouTube Data API v3
- Transcript extraction from videos
- Semantic search using embeddings
- Video ranking based on content relevance
- Optional summarization using LLM

## Setup

1. Install dependencies:

```bash
pip install -r requirements.txt
```

2.Create a `.env` file with your API keys:

```env
YOUTUBE_API_KEY=your_youtube_api_key
```

3.Run the script:

```bash
python main.py
```

## Usage

The script can be used in two ways:

1. Command line:

```bash
python main.py --query "your search query" --max_results 10
```

2.As a module:

```python
from youtube_ranker import YouTubeRanker

ranker = YouTubeRanker()
results = ranker.search_and_rank("your search query", max_results=10)
```

## Running the Application Locally

To run the application locally, follow these steps:

1. **Install Dependencies**:

   ```bash
   pip install -r requirements.txt
   ```

2. **Set Up Environment Variables**:
   Create a `.env` file in the root directory and add your API keys:

   ```env
   YOUTUBE_API_KEY=your_youtube_api_key
   ```

3. **Start the Flask Application**:
   Run the following command to start the Flask server:

   ```bash
   python main.py
   ```

4. **Access the API**:
   Open your browser or API client (e.g., Postman) and navigate to:

   ```cmd
   http://127.0.0.1:5000/ranked_videos
   ```

   Use the POST method to send a JSON payload with the following structure:

   ```json
   {
       "main_content": ["your search query"],
       "max_results": 10
   }
   ```

5. **View Results**:
   The API will return a list of ranked video links. Additionally, the results will be saved to a CSV file named `ranked_videos.csv` in the root directory.

## Running the Application via Docker

To run the application using Docker, follow these steps:

1. **Build the Docker Image**:

   ```bash
   docker build -t youtube-ranking-service .
   ```

2. **Run the Docker Container**:

   ```bash
   docker run -p 5000:5000 --env-file .env youtube-ranking-service
   ```

   This will start the Flask application inside the container and make it accessible on:

   ```cmd
   http://127.0.0.1:5000/ranked_videos
   ```

3. **Access the API**:
   Use the POST method to send a JSON payload with the following structure:

   ```json
   {
       "main_content": ["your search query"],
       "max_results": 10
   }
   ```

4. **View Results**:
   The API will return a list of ranked video links. Additionally, the results will be saved to a CSV file named `ranked_videos.csv` in the root directory of the container.

## Example Usage

You can test the API using the following `curl` command:

```bash
curl --location 'http://127.0.0.1:5000/ranked_videos' \
--header 'Content-Type: application/json' \
--data '{
    "order": 1,
    "title": "ELECTRIC CURRENT AND CIRCUIT",
    "main_content": [
        "We are familiar with air current and water current. We know that flowing water constitute water current in rivers. Similarly, if the electric charge flows through a conductor (for example, through a metallic wire), we say that there is an electric current in the conductor. In a torch, we know that the cells (or a battery, when placed in proper order) provide flow of charges or an electric current through the torch bulb to glow. We have also seen that the torch gives light only when its switch is on. What does a switch do? A switch makes a conducting link between the cell and the bulb. A continuous and closed path of an electric current is called an electric circuit. Now, if the circuit is broken anywhere (or the switch of the torch is turned off), the current stops flowing and the bulb does not glow.\nHow do we express electric current? Electric current is expressed by the amount of charge flowing through a particular area in unit time. In other words, it is the rate of flow of electric charges. In circuits using metallic wires, electrons constitute the flow of charges. However, electrons were not known at the time when the phenomenon of electricity was first observed. So, electric current was considered to be the flow of positive charges and the direction of flow of positive charges was taken to be the direction of electric current. Conventionally, in an electric circuit the direction of electric current is taken as opposite to the direction of the flow of electrons, which are negative charges.\nIf a net charge $Q$, flows across any cross-section of a conductor in time $t$, then the current $I$, through the cross-section is\n$$\nI=\\frac{Q}{t}\n$$\nThe SI unit of electric charge is coulomb (C), which is equivalent to the charge contained in nearly $6 \\times 10^{18}$ electrons. (We know that an electron possesses a negative charge of $1.6 \\times 10^{-19} \\mathrm{C}$.) The electric current is expressed by a unit called ampere (A), named after the French scientist, Andre-Marie Ampere (1775-1836). One ampere is constituted by the flow of one coulomb of charge per second, that is, $1 \\mathrm{~A}=1 \\mathrm{C} / 1 \\mathrm{~s}$. Small quantities of current are expressed in milliampere $\\left(1 \\mathrm{~mA}=10^{-3} \\mathrm{~A}\\right)$ or in microampere ( $1 \\mu \\mathrm{~A}=10^{-6} \\mathrm{~A}$ ).",
        "An instrument called ammeter measures electric current in a circuit. It is always connected in series in a circuit through which the current is to be measured. Figure 11.1 shows the schematic diagram of a typical electric circuit comprising a cell, an electric bulb, an ammeter and a plug key. Note that the electric current flows in the circuit from the positive terminal of the cell to the negative terminal of the cell through the bulb and ammeter.",
        "A current of 0.5 A is drawn by a filament of an electric bulb for 10 minutes. Find the amount of electric charge that flows through the circuit.",
        "We are given, $I=0.5 \\mathrm{~A} ; t=10 \\mathrm{~min}=600 \\mathrm{~s}$.\nFrom Eq. (11.1), we have\n$$\n\\begin{aligned}\nQ & =I t \\\",
        "\\end{aligned}\n$$",
        "1. What does an electric circuit mean?\n2. Define the unit of current.\n3. Calculate the number of electrons constituting one coulomb of charge."
    ],
    "figures": [
        {
            "url": "https://cdn.mathpix.com/cropped/2025_04_25_93040668ad4a1a9e2597g-02.jpg?height=428&width=743&top_left_y=848&top_left_x=147",
            "description": "A schematic diagram of an electric circuit comprising - cell, electric bulb, ammeter and plug key"
        }
    ],
    "tables": [],
    "activities": [],
    "questions": [
        {
            "question_text": "1. What does an electric circuit mean?"
        },
        {
            "question_text": "2. Define the unit of current."
        },
        {
            "question_text": "3. Calculate the number of electrons constituting one coulomb of charge."
        }
    ],
    "do_you_know": [],
    "recall_activities": [],
    "exercises": [],
    "what_you_learnt": [],
    "group_activities": [],
    "more_to_know": [],
    "examples": [
        {
            "title": "Example 11.1",
            "content": "A current of 0.5 A is drawn by a filament of an electric bulb for 10 minutes. Find the amount of electric charge that flows through the circuit.",
            "solution": "We are given, $I=0.5 \\mathrm{~A} ; t=10 \\mathrm{~min}=600 \\mathrm{~s}$.\nFrom Eq. (11.1), we have\n$$\n\\begin{aligned}\nQ & =I t \\\\n& =0.5 \\mathrm{~A} \\times 600 \\mathrm{~s} \\\\n& =300 \\mathrm{C}\n\\end{aligned}\n$$"
        }
    ],
    "summary": [],
    "points_to_ponder": [],
    "max_results": 30
}'
```
